<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}" lang="ko">

<th:block layout:fragment="css">
    <head>
        <link rel="stylesheet" type="text/css" th:href="@{/static/css/code/common.css}"/>
        <title>공통 코드 관리</title>
    </head>
</th:block>

<th:block layout:fragment="content">
    <div id="main_wrapper">
        <h1>공통 코드 관리</h1>
    </div>
    <div id="content_wrapper">
        <div id="search_wrapper" class="bg-secondary p-1">
            <p>
                <span th:text="구분"/>
                <select id="searchDateType" th:field="*{commonCodeCategoryList}">
                    <option th:each="ele : ${commonCodeCategoryList}" th:value="${ele.getCode()}" th:text="|${ele.getDisplayName()}|"></option>
                </select>
            </p>
            <p>
                <span th:text="|코드 그룹 선택|"></span>
                <select id="searchKeywordType" th:field="*{commonCodeGroupList}">
                    <option th:each="ele : ${commonCodeGroupList}" th:value="${ele.getCode()}" th:text="|${ele.getDisplayName()}|"></option>
                </select>
            </p>
        </div>

        <div id="list_wrapper" class="p-sm-2">
            <table class="table table-bordered text-center">
                <div>
                    <input id="saveBtn" type="button" value="저장">
                </div>
                <thead>
                    <tr>
                        <th class="text-center" scope="col">No</th>
                        <th class="text-center" scope="col">코드</th>
                        <th class="text-center" scope="col">항목명</th>
                        <th class="text-center" scope="col">설명</th>
                        <th class="text-center" scope="col">사용설정</th>
                        <th class="text-center" scope="col">추가 / 삭제</th>
                    </tr>
                </thead>
                <tbody id="codeList">
                    <tr th:if="${not #lists.isEmpty(list)}" th:each="row, stat : ${list}">
                        <td th:text="${row.getCodeSeq()}"></td>
                        <td th:text="${row.getCodeCd()}"></td>
                        <td th:text="${row.getCodeNm()}"></td>
                        <td th:text="${row.getCodeDesc()}"></td>
                        <td th:text="${row.getUseYn()}"></td>
                        <td><input type="button" value="추가"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(list)}">
                        <td class="no-row-found" colspan="9" th:text="|데이터가 없습니다.|"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</th:block>

<th:block layout:fragment="script">
    <script th:inline="javascript">

        // 목록 조회
        let fnSearchList = (currentPage, displayRow, totalCount) => {
            // 날짜 조건 검증
            if($('#searchDateType option:selected').val() === 'REG_DT') {
                if($('#sDate').val() === '' || $('#eDate').val() === '') {
                    alert('검색할 날짜를 선택하세요.');
                    return false;
                }
            }

            // 검색어 조건 검증
            if($('#searchKeywordType option:selected').val() !== 'ALL') {
                if($('input[name=searchWord1]').val() === '') {
                    alert('검색어를 입력하세요.');
                    return false;
                }
            }

            const data = {
                boardPublicVO: {
                    searchDateType: $('#searchDateType option:selected').val(),
                    startDt: $('#sDate').val(),
                    endDt: $('#eDate').val(),
                    searchKeywordType: $('#searchKeywordType option:selected').val(),
                    searchWord1: $('input[name=searchWord1]').val()},
                paging: {
                    currentPage: currentPage,
                    displayRow: displayRow,
                    totalCount: totalCount
                }
            }

            $.ajax({
                url: '/board/api/list',
                type: 'post',
                dataType: 'text',
                contentType: 'application/json; charset=UTF-8',
                data: JSON.stringify(data)
            })
            .done(function(data) {
                $('#list_wrapper').replaceWith(data);
            })
            .fail(function(jqXHR) {
                console.log(jqXHR);
            });
        }

        // 게시글 삭제
        let fnDeleteBoard = () => {
            let checkedList = [];
            $('input[name=chkbox]:checked').each(function() {
                checkedList.push(this.value);
            });
            if(checkedList.length < 1) {
                alert('삭제 처리 하실 게시판을 선택 해주세요.');
                return false;
            }
            if(!confirm('선택한 게시판을 삭제 처리 하시겠습니까?')) {
                return false;
            }
            $.ajax({
                url: '/board/api/delete',
                type: 'delete',
                data: {lastId: 'ij', checkedList: checkedList}
            })
            .done(function(data) {
                console.log(data);
                fnSearchList(1, 10, 0);
            })
            .fail(function(jqXHR) {
                console.log(jqXHR);
            });
        }
    </script>
</th:block>
</html>