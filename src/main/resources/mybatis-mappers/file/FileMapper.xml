<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dejay.framework.mapper.file.FileMapper">
    <!-- 공통 [[ -->
    <sql id="fileColumn">
        ${alias}FILE_SEQ, ${alias}ENTITY_NAME,
        ${alias}ENTITY_SEQ, ${alias}ENTITY_TYPE,
        ${alias}FILE_PATH, ${alias}FILE_NAME,
        ${alias}ORIGIN_FILE_NAME, ${alias}FILE_TYPE,
        ${alias}FILE_SIZE
    </sql>

    <!-- 공통 ]] -->


    <!-- 조회 [[ -->

    <select id="getFiles" parameterType="Long">
        SELECT
            <include refid="fileColumn"><property name="alias" value="FE."/></include>
        FROM FILE FE
        WHERE FE.ENTITY_SEQ = #{entitySeq}
    </select>

    <select id="getMaxSeq" parameterType="String">
        SELECT MAX(${tableName}_SEQ) AS SEQ
        FROM ${tableName}

    </select>

    <select id="getFile" parameterType="Long" resultType="FileVO">
        SELECT
            <include refid="fileColumn"><property name="alias" value="FE."/></include>
        FROM FILE FE
        WHERE FE.FILE_SEQ = #{entitySeq}
    </select>

    <!-- 조회 ]] -->

    <!-- 저장/수정/삭제 [[ -->

    <insert id="save" >
        /* 파일 저장 - FileMapper.insert */
        INSERT INTO FILE
        (
            ENTITY_NAME,ENTITY_SEQ,
            ENTITY_TYPE, FILE_PATH,
            FILE_NAME, ORIGIN_FILE_NAME,
            FILE_TYPE,FILE_SIZE
        )
        VALUES
            (
                #{entityNm},#{entitySeq},
                #{entityType},#{filePath}
                ,#{fileNm},#{orgFileNm},
                #{fileType},#{fileSize}
            )
    </insert>

    <update id="deleteFile">
        /* 파일 삭제 - FileMapper.delete */
        DELETE FROM FILE WHERE FILE_SEQ = ${fileSeq}
    </update>

    <!-- 저장/수정/삭제 ]] -->
</mapper>